
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- <link rel="shortcut icon" href="../../docs-assets/ico/favicon.png"> -->

    <title>AgMIP Search Page</title>

    <!-- Bootstrap core CSS -->
    <link href="static/css/agmip_custom.css" rel="stylesheet">
    <link href="static/css/bootstrap.css" rel="stylesheet">
    <link href="static/font-awesome/css/font-awesome.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="static/css/footer.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
	<!-- ~~~~~~~~~~~~Knockout~~~~~~~~~~~~ -->
	<script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/2.3.0/knockout-min.js" ></script>
	
  </head>

  <body>
    <!-- Wrap all page content here -->
    <div id="wrap">

      <!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          <a class="agmipLogo pull-left menuDivider" href="index.html">
            <img src="static/images/AgMIP_logo_100x50.png" /> 
            <div class="dataExchange">| Data Exchange</div>
          </a>
          </div>
          <div class="collapse navbar-collapse pull-left menuPad">
            <ul class="nav navbar-nav">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Databases <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://test.agmip.org/ace">AgMIP Crop Database (Site-based)</a></li>
                    <li class="divider"></li>
				  <li> <a href="newupload.html">Upload Data</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">AgMIP Sites <b class="caret"></b></a>
                <ul class="dropdown-menu">
                	<li><a href="http://www.agmip.org">AgMIP.org </a></li>
                	<li><a href="http://research.agmip.org">AgMIP Research</a></li>
                	<li><a href="http://tools.agmip.org">AgMIP Toolshed</a></li>
                </ul>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
          <div class="collapse navbar-collapse navbar-ex1-collapse pull-right">
          	<ul class="nav navbar-nav navbar-right navbar-user ">
            	<li class="menuDivider">
             		 <a href="http://auth.agmip.org/?for=http://test.agmip.org/"class="greenBtn">
                        <span class="greenBtnText tenLeft">Login</span>
                     </a>
            	</li>
            	<li class="menuDivider">
              		<a href="login.html"class="greenBtn"><span class="greenBtnText">Sign Up</span></a>
            	</li>
          	</ul>
        </div><!-- /.navbar-collapse -->
        </div>
	 </div>

      <!-- Begin page content -->
      <!-- This is where the General Information section goes-->
      <div class="topUploadSection col-sm-12">
        <div class="container" >
        	<div class="disIn col-sm-12">
        		<h1 class="searchPageTitle" style="padding-left:0px;"><a class="collapseBtn" data-toggle="collapse" data-target="#searchSection">

  						</a> Search AgMIP Crop Database(Site-based)</h1>
        		<div class="pull-right menuDivider">
        		<div class="pull-right ShowDataTxt searchPos">
  				<ul class="nav navbar-nav navbar-left padLeft agmipSearch">
  					<li><div style="padding-top:15px;padding-right:10px; font-size:16px;"> Select Crop:</div></li>
            		<li class="menuDivider">
              			<div class="form-group" style="margin-top:8px; height:35px; width:200px;">
                            <select id="crop_filter" class="searchBox form-control" >
                                <option value="none">None</option>
                                <option value="BAR">Barley</option>
                                <option value="BRC">Brachiaria</option>
                                <option value="WHB">Bread wheat</option>
                                <option value="CBG">Cabbage</option>
                                <option value="PPR">Capsicum pepper</option>
                                <option value="CSV">Cassava</option>
                                <option value="CHP">Chickpea</option>
                                <option value="COT">Cotton</option>
                                <option value="CWP">Cowpea</option>
                                <option value="BND">Dry bean</option>
                                <option value="WHD">Durum wheat</option>
                                <option value="FBN">Faba bean</option>
                                <option value="SGG">Grain sorghum</option>
                                <option value="BNG">Green bean</option>
                                <option value="MAZ">Maize</option>
                                <option value="PNT">Peanut</option>
                                <option value="PML">Pearl millet</option>
                                <option value="POT">Potato</option>
                                <option value="RIC">Rice</option>
                                <option value="SBN">Soybean</option>
                                <option value="SUC">Sugarcane</option>
                                <option value="SUN">Sunflower</option>
                                <option value="SWC">Sweet corn</option>
                                <option value="TAN">Tanier</option>
                                <option value="TAR">Taro</option>
                                <option value="TOM">Tomato</option>
                                <option value="VBN">Velvet bean</option> 
    						</select>
            		</li>
            		<li class="menuDivider">
              			<a id="apply_filter" class="searchBtn"><span class=" glyphicon glyphicon-search greenSearchText"></span></a>
            		</li>
            		 <li class="menuDivider">
                      			<a id="obtain_data" class="greenBtn">
                                    <span class="greenBtnText">View Metadata</span>
                                </a>
                    </li>
            		<li class="menuDivider">
              			<a href="" class="helpBtnBg"><div class="helpBtn" style="text-align:center;">?</div></a>
            		</li>
          		</ul>
  					</div>
        		</div>
        	</div>
        	<div id="searchSection" class="collapse in">
        	<div class="col-sm-12">
        		<!-- Map goes here -->
        		<div id="map" style="height:420px"></div>
        	</div>
        	</div>
        </div>
      </div>    

      <div class="col-sm-12 bottomContentSection">
      		<div class="container">
        		<div class="col-sm-12">
        			<h4 class="pull-left greyTxt"> 
              	  		<a class="collapseBtn collapsed" data-toggle="collapse" data-target="#current_data_container">
  						</a> 
  						Search Results:
  					</h4>
  					<div class="pull-right ShowResTxt">
  						<h4 id="current_data_number" class="greyTxt" style="display:none">Showing 
                            <b  class="resultsNum" ></b> 
                            Results
                        </h4>
  					</div>
        		</div>
        	<div id="current_data_container" class="collapse">
          		<div class="col-sm-12 table-responsive">
                    <!-- ~~~~~~~~~~~~ this is the current data table ~~~~~~~~~~~~~~~ -->
                    <div id="current_data" style="display:none" >
						<div class="agmipTable">
							<table class="table table-striped table-hover noWrap" >
								<thead>
									<tr> 
										<th class="headerTbl ">
											<input id="select_all_current_data" type="checkbox" data-bind="click: vm.selectAllCurrentDataClicked, checked: vm.selectedAllChecked">
										</th>
										<th class="headerTbl ">Crop</th> 
										<th class="headerTbl ">Planting Date</th> 
										<th class="headerTbl ">Soil Texture</th> 
										<th class="headerTbl ">Institution</th> 
										<th class="headerTbl ">Country</th> 
										<th class="headerTbl ">EXNAME</th> 
										<th class="headerTbl ">AgMIP Rating</th> 
									</tr>
								</thead>
								


								<tbody data-bind="foreach: current_data">
									<tr>
										<td data-type='selector'>
											<input class='current_data_selector' type='checkbox' data-bind="onClick: vm.selectorClicked, attr: { 'checked':checked, 'data-id': eid }">

										</td>
										<td data-bind="text: crid"></td>
										<td data-bind="text: pdate"></td>
										<td data-bind="text: soil"></td>								
										<td data-bind="text: institution"></td>
										<td data-bind="text: country"></td>
										<td data-bind="text: exname"></td>									
										<td data-bind="text: rating"></td>							
									</tr>
								</tbody>
							</table>
                        </div>
                    </div>                    
                    <!-- ~~~~~~~~~~~~ this is the current data table ~~~~~~~~~~~~~~~ -->
          		<div class="pull-right ShowDataTxt rghtNeg5" >
          		<ul class="nav navbar-nav navbar-left padLeft">
            		<li class="menuDivider">
              			<a id="select_all_current_data" class="greenBtn" style="display:none">
                        <span class="greenBtnText">Select All</span></a>
            		</li>
            		<li class="menuDivider">
              			<a id="clear_current_data" class="blueBtn" style="display:none" data-bind="click: removeAllCurrentData">
                            <span class="blueBtnText">Clear</span>
                        </a>
            		</li>
          		</ul>
          		</div>
          		</div>
          		
            </div>

        	</div>
      </div>
            <div class="col-sm-12 midUploadSection">
      		<div class="container">
        		<div class="col-sm-12">
        			<h4 class="pull-left greyTxt"> 
              	  		<a class="collapseBtn collapsed" data-toggle="collapse" data-target="#saved_data_container">
  						</a> 
  						Selected Data:  
                        <span id="saved_data_number" class="badge" style="display:none" ></span>
  					</h4>
        		</div>
        	<div id="saved_data_container" class="collapse ">
          		<div class="col-sm-12 table-responsive">
                    <!-- ~~~~~~~~~~~~ this is the saved data table ~~~~~~~~~~~~~~~ -->
                    <div id="saved_data" style="display:none" >
                      <div class="agmipTable">
                        <table class="table table-striped table-hover noWrap" >
							<thead>
                                <th class="headerTbl ">
									<span id="clear_saved_data" class='glyphicon glyphicon-remove' data-bind="click:clearSavedData"></span>
								</th> 
                                <th class="headerTbl ">Crop</th> 
                                <th class="headerTbl ">Planting Date</th> 
                                <th class="headerTbl ">Soil Texture</th> 
                                <th class="headerTbl ">Institution</th> 
                                <th class="headerTbl ">Country</th> 
                                <th class="headerTbl ">EXNAME</th> 
                                <th class="headerTbl ">AgMIP Rating</th> 
							</thead>
							<tbody data-bind="foreach: saved_data">
								<tr>
									<td data-type='selector'>
										<span class='saved_data_selector glyphicon glyphicon-remove'></span>
									</td>
									<td data-bind="text: crid"></td>
									<td data-bind="text: pdate"></td>
									<td data-bind="text: soil"></td>								
									<td data-bind="text: institution"></td>
									<td data-bind="text: country"></td>
									<td data-bind="text: exname"></td>									
									<td data-bind="text: rating"></td>							
								</tr>
							</tbody>							
                        </table>
                        </div>
                    </div>

                    <!-- ~~~~~~~~~~~~ this is the saved data table ~~~~~~~~~~~~~~~ -->


                    <!-- ~~~~~~~~~~~~ download button ~~~~~~~~~~~~~~~ -->
  					<div class="pull-right ShowDataTxt rghtNeg5" >
  				        <ul class="nav navbar-nav navbar-left padLeft">
                    		<li class="menuDivider">
                      			<a id="raise_up_download_modal" class="greenBtn saved_data_button" 
                                style="display:none" data-toggle="modal" data-target="#DownloadModal">
                                    <span class="greenBtnText">Download Data</span>
                                </a>
                    		</li>
                  		</ul>
  					</div>
                    <!-- ~~~~~~~~~~~~ download button ~~~~~~~~~~~~~~~ -->

          		</div>
            </div>

        	</div>
      </div>
    </div>

    <!-- ~~~~~~~~~~~~ footer ~~~~~~~~~~~~~~~ -->
    <div id="footer">
      <div class="container" style="padding-top:5px;">
        <div class="col-sm-12">
        <div class="col-sm-4 ">
       		  <i class="fa fa-envelope-o fa-2x yellowText envIcon"></i>
       		  <div class="disIn"> AgMIP IT is based at the University of Florida <br>
       		  Email: <a href="mailto:it@agmip.org" class="yellowText">it@agmip.org</a>
       		  </div>
       		</div>
        	         <div class="col-sm-4">
       			<p style="color:#ffffff;">
       				AgMIP's mission is to improve substantially the characterization of world food security as affected by climate variability and change, and to enhance adaptation capacity in both developing and developed countries.
       			</p>
       		</div>
       		<div class="col-sm-4">
       			<p style="color:#ffffff;">
       				AgMIP gratefully acknowledges major support from the UK Department for International Development's UKaid in partnership with the US Department of Agriculture Agricultural Research Service.
       			</p>
       		</div>
        </div>
      </div>
    </div>
    <!-- ~~~~~~~~~~~~ footer ~~~~~~~~~~~~~~~ -->


<!-- ~~~~~~~~~~~~ Download modal ~~~~~~~~~~~~~~~ -->
<div class="modal fade" id="DownloadModal" tabindex="-2" role="dialog" aria-labelledby="download modal" aria-hidden="true" >
  <div class="modal-dialog">
    <div class="modal-content bord0">
      <div class="modal-header modHead">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="DownloadModalTitle">Download Data</h4>
      </div>
      <div class="modal-body">
        <h4> Please select from the following options, how you want your data formatted.</h4>
           <p>(Please select one)</p>
            <div class="form-group" style="font-size:18px;">
                <div class="checkbox">
                  <label>
                    <input class="db_type_filter" type="checkbox" value="ACE"/>
                    ACEDB
                  </label>
                </div>
               <div class="checkbox">
                  <label>
                    <input class="db_type_filter" type="checkbox" value="DOME"/>
                    DOME
                                      </label>
                </div>
               <div class="checkbox">
                  <label>
                    <input class="db_type_filter" type="checkbox" value="ACMO"/>
                    ACMO
                  </label>
                </div>
              </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger bord0" data-dismiss="modal">Cancel</button>
        <button id="download_data" type="button" class="btn btn-success bord0" data-dismiss="modal" disabled="">OK</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- ~~~~~~~~~~~~ Download modal ~~~~~~~~~~~~~~~ -->

<!-- Alert Modal-->
<div class="modal fade" id="alertModal" tabindex="-1" role="dialog" aria-labelledby="alert modal" aria-hidden="true" >
  <div class="modal-dialog">
    <div class="modal-content bord0">
      <div class="modal-header modHead alertHead">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="error_message_title">Alert</h4>
      </div>
      <div class="modal-body">
        <h4 id="error_message"></h4>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success bord0" data-dismiss="modal" >OK</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>
<!-- Alert Modal -->

<!-- Spinner Modal-->
<div class="modal fade" id="spinner" tabindex="-1" role="dialog" aria-labelledby="spinner modal" aria-hidden="true" style="">

	
      <div class="modal-body">
		<img id="spinner_image" src="static/images/spinner.gif" /> 
      </div>


</div>
<!-- Spinner Modal-->


    <!-- ~~~~~~~~~~~~Jquery~~~~~~~~~~~~ -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

    <!-- ~~~~~~~~~~~~Leaflet~~~~~~~~~~~~ -->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.css" />
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.js"></script>

    <!-- ~~~~~~~~~~~~Leaflet Clustering~~~~~~~~~~~~ -->
    <link   rel="stylesheet" href="static/css/leaflet_cluster.css" />
    <script src="static/js/leaflet_cluster.js" ></script>
	
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="static/js/bootstrap.js" ></script>
    <script src="static/js/table_and_button_functions.js" ></script>
    <script src="static/js/api_related_bindings.js" ></script>
    <script src="static/js/non_api_related_bindings.js" ></script>
    <script src="static/js/api.js" ></script>
    <script src="static/js/map_functions.js" ></script>


	<script>
	function experiment(eid, crid, pdate, soil, institution, country, exname, rating, checked) 
	{

		var self = this;

		self.eid			= eid;			
		self.crid			= crid;
		self.pdate			= pdate;
		self.soil			= soil;
		self.institution	= institution;
		self.country		= country;
		self.exname			= exname;
		self.rating			= rating;
		self.checked		= ko.observable(checked);
	
	}


	function all_experiments() {
		var self = this;
		
		self.current_data 		= ko.observableArray([]);
		self.saved_data 		= ko.observableArray([]);		
		self.selectedAllChecked = ko.observable(false);	
		

		
		self.updateCheckMark = function(index, value) 
		{	
			//function assigns a value to the check mark
			self.current_data()[index].checked(value);
		}
		
		self.toggleCheckMark = function(index) 
		{
			//function reverses the boolean value of the checkmark
			self.current_data()[index].checked( !self.current_data()[index].checked() );
		}
		
		self.deselectAllCheckMarks = function() 
		{
			//function loops through all checkmarks and sets them to false
			for( i=0; i< self.current_data().length; i++ )
			{
				self.updateCheckMark(i, false);
			}
			//self.show_hide_current_data_table();
			self.saved_data([]);
	
			self.show_hide_saved_data_table();
		}	
		
		self.selectAllCheckMarks = function() 
		{
			for( var i=0; i < self.current_data().length; i++)
			{
				current_data_eid = self.current_data()[i]["eid"];
				index = find_index(current_data_eid, self.saved_data());
				
				if(index == -1)
				{
					//the current_data eid is not in the array then push it into saved_data
					self.saved_data.push( self.current_data()[i] );
					self.updateCheckMark(i, true);
				}
				
			}
			self.show_hide_saved_data_table();
		}	
		
		self.selectAllCurrentDataClicked = function()
		{
		

			if(self.selectedAllChecked())
			{
				//this is when de-selection is occurring
				self.selectedAllChecked(false);
				
				self.deselectAllCheckMarks();
				
			}else{
				//this is when selection is occurring			
				self.selectedAllChecked(true);

				self.selectAllCheckMarks();
				//moves view down to saved data container. Let's user know that something changed
				$('html, body').animate({scrollTop: $("#saved_data_container").offset().top}, 1200);

			}
			

			return true;
		}
		
		self.removeAllCurrentData = function()
		{
			$("#clear_current_data").css("display","none");
			$("#current_data_number").hide();
			$("#current_data").hide();
			self.current_data([]);				//empties the array
			
			self.selectedAllChecked(false);		//deselects the select all checkbox
		}
		
		
		self.clearSavedData = function()
		{
			self.saved_data([]);
			
			self.deselectAllCheckMarks();

			self.show_hide_saved_data_table();		
		}
		
		//-----------------------------------------------------------find index of eid
		self.find_index = function(eid, array)
		{
			//array returns index of eid or -1 (if eid is not in array)
			//assumption: the eid and array[i]["eid"] are both strings
			
			for( var i=0; i < array.length; i++)
			{
			var a = array[i]["eid"];
				if(eid == array[i]["eid"])
				{
					return i;
				}
			}
			return -1;

		}
		//-----------------------------------------------------------find index of eid
	
		self.selectorClicked = function(experiment) 
		{
			//alert(JSON.stringify(experiment)); //works
			
			/*
				(1)Code gets eid html data-id
				(2)Code uses eid to get the saved_data_index
				
				(3a) If saved_data_index is -1, then the eid is not in the saved_data array
				(4a) Code uses the eid to find the current_data_index
				(5a) Code uses the index to get the corresponding datum for the eid
				(6a) And pushes that datum into the saved_data array
				
				(3b) If saved_data_index is not -1, code uses the saved_data_index to remove the datum for that corresponding eid from the saved_data array	
			*/
				eid = $(this).data('id');
	
	saved_data_index = find_index(eid, vm.saved_data());
	
	if(saved_data_index == -1 )									//(3a)
	{
		current_data_index = find_index(eid, vm.saved_data()); 	//(4a)
		datum = vm.current_data()[current_data_index];			//(5a)
		vm.current_data.push(datum);							//(6a)
	}else{
	
		vm.saved_data()[saved_data];
	}
			
		}
		
		
		//---------------------------controls visibility of current table
		self.show_hide_current_data_table = function()
		{
			//shows current data
			$("#current_data").show();	
			$("#clear_current_data").show();

			//sets the current_data_number
			$('#current_data_number').show();
			$('#current_data_number').find("b").text(self.current_data().length);

			//if the current_data_container is toggled, then un toggle it
			//information on whether the current_data_container is toggled is stored else where
			var toggle_me_element = $("a[data-target='#current_data_container']");

			if(toggle_me_element.hasClass("collapsed")){
				toggle_me_element.removeClass("collapsed");
				$('#current_data_container').collapse('toggle');
				}
			
			//moves view down to current data container. Let's user know that something changed
			$('html, body').animate({scrollTop: $("#current_data_container").offset().top}, 1200);
		}
		//---------------------------controls visibility of current table
		
		//---------------------------controls visibility of saved table
		self.show_hide_saved_data_table = function()
		{
			if( vm.saved_data().length > 0)
			{   
				//shows saved data
				$("#saved_data").show();
				
				$(".saved_data_button").show();

				//if the saved_data_container is toggled, then un toggle it
				//information on whether the saved_data_container is toggled is stored else where
				var toggle_me_element = $("a[data-target='#saved_data_container']");

				if(toggle_me_element.hasClass("collapsed")){
					toggle_me_element.removeClass("collapsed");
					$('#saved_data_container').collapse('toggle');
				}
			
				//sets the current_data_number
				$('#saved_data_number').show();
				$('#saved_data_number').text(self.saved_data().length);

			}
			else
			{
				$("#saved_data").hide();
				$(".saved_data_button").hide();

				$('#saved_data_number').hide();
				$("#select_all_current_data").prop('checked', false);

			}
		}
		//---------------------------controls visibility of saved table

	
	}

	
	var vm = new all_experiments();
		
	ko.applyBindings(vm);
	
	
	
	
	
	
	
	</script>
	
	
  </body>
</html>
























